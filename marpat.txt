特許事務ツールマクロ marpat.mac
Copyright(c) 1997-2009   依田　茂

　特許明細書作成者用のマクロですので、特許業界以外の方には使い道がないと思います。

　特許文書に関して、段落番号付け、段落番号取り、符号表の作成、要約書の文字数カウント等ができます。パソコン電子出願用入力支援部分もあり、これを使えば修飾タグ等が連続入力できますが、その場合、カーソルが自由に動けるようになってタグの開始箇所と終了箇所を指定できるようになっています。マクロが終了したと勘違いしないようしてください。開始箇所と終了箇所を同じにする、即ち、同一箇所で２回エンターキーを押すことで連続入力が終了します。上端のタイトルバーにご注目！

　html文書での段落番号付けは、文書中のいずれかの箇所に既に<BR>があれば、<BR>付きで段落番号を付けます。但し、文書中のいずれかの箇所に<PRE>がある場合には、<BR>は付けません。ですから、文書中の複数箇所に飛び飛びで<PRE></PRE>がある場合には、現在対応していません。

　ダイアログ表示をするために、秀まるおさんのマクロサーバが必須です。秀まるおさんのマクロサーバは、次のいずれかで入手してください。
(1)Vector
(2)秀まるおさんのホームページ http://hidemaru.xaxon.co.jp/
本マクロ中の、マクロサーバを扱っている個所は、秀まるおさんのマクロサーバに添付の例マクロを参考にさせていただきました。

MS-Wordとの連動機能を発揮するにはWordの方にもマクロを組み込む必要があります。これ用のWordマクロはもはや公開していませんが、WORD版新特許事務ツールENPAWDのユーザーの方は、秀丸を一端終了して、WORDの方から「HTML又はタグ付きTXTからの読み込み」で処理すれば良いので、特に問題はないでしょう。

【動作条件】  秀丸エディタ (ver. 7.10)で動作確認しています。

【インストールの仕方】秀丸エディタのマクロディレクトリにmarpat.macを解凍して下さい。Ver.upでない方は、秀まるおさんのマクロサーバを、同じフォルダか又はpathの通った別のフォルダに解凍してください。後はmarpat.macを実行すればよいのです。例えば、メニューのその他(O)-メニュー編集(M)でユーザーメニューのメニュー8:右ボタンにmarpat.macを割り付けると使いやすいかもしれません。

【最新版アップロードサイト】
　最新版のアップロードは特許事務ツール公式サイトである

 http://macro.unicorned.com/

にて行います。

【バージョン履歴】
  09/1/07      Ver. 1.31
三極共通書式での段落番号付けで、符号の説明の欄に２以上の不要な段落番号がついてしまうバグを取りました。

  08/12/31     Ver. 1.30
(1)2009年1月からの三極共通書式に対応しました。具体的には、テンプレート入力と段落番号付けにおいて対応しました。
(2)旧書式のテンプレート入力機能は削除しました。従って、テンプレート入力できるのは、三極共通書式、2008年12月までの新書式、そして国際出願書式です。
  07/11/14     Ver. 1.29  
(1)Ver. 1.27でバグ取りしたはずなのに、国際出願に関して場合によっては【発明を実施するための最良の形態】以降に段落番号が依然として付かないバグがありましたので、正しました。
(2)明細書中の図や表のためのソースタグ<IMG SRC=...の直前にも段落番号が付くバグを正しました。
(3)マクロ終了時にマクロサーバーが切り離されているのに、「マクロサーバーの切り離しに失敗しました」と出ることが多く、非常にうざったいので、このメッセージの出る仕組みそのものを削除しました。万一マクロサーバーの切り離しに失敗しても大きな弊害はないため。
  07/11/11     Ver. 1.28  国際出願に関する段落番号付けで、【符号の説明】の欄に余分な段落番号が付くバグがありましたので、その点を正しました。
  07/11/08     Ver. 1.27  実に、４年ぶりのver.upですね。国際出願のテンプレートを導入しました。国際出願の場合、願書を選んでも出力されないようにしてあります。国際出願の場合にも、段落番号付けが正しく行えるよう改良しました。
  03/08/11     Ver. 1.26  (1)marpatの下線、上付、下付のタグ付け機能のみを取り出した、マクロサーバなしで実行できるpasotag.macを付録で添付しました。

　03/08/08     Ver. 1.25  (1)上付や下付を行った後に、「マクロサーバの切り離しに失敗しました。」というエラーメッセージが無意味に出るバグを取りました。(2)拡張子hlpタイプのヘルプファイルを造る予定なのですが、まだ出来てません。従って、今回もヘルプは、ヴァージョンアップ内容を反映していません<(_ _)>。

　03/07/06     Ver. 1.24  (1)符号表の作成に今までは、中河原与太郎さんのご好意でcbsort.exeを同梱、利用させていただいていました。これからは、これに代わってマクロ中でM.TsukamotoさんのSort.mac(Written 1:99/05/10(月))のバブルソートのロジックを利用させていただくことにし、符号表作成のより高速化を目指しました。それに伴い、符号表作成後にそのままマクロを終了する際、マクロサーバが終了しないで残ってしまうようになりました。これはまずいので、「終了後初期メニューに戻る」オプションがたとえオフでも、符号表作成の場合には作業終了後、初期メニューに戻るよう仕様変更しました。(2)旧→新方式へのコンバートで、変換後も段落番号が残っている、バグを取りました。(3)ユーザーの意見を参考にさせていだたいて、符号表の作成でギリシャ文字を頭に持つ「α型装置２５」や、途中にひらがなが混在する「取り付け手段１０」や、アルファベットで始まる「ＯＡ機器１６０」がヒットするよう改善を試みました。(4)拡張子hlpタイプのヘルプファイルを造る予定なのですが、まだ出来てません。従って、今回もヘルプは、ヴァージョンアップ内容を反映していません<(_ _)>。

  03/06/23     Ver. 1.23  (1)旧のテンプレート入力で請求の範囲が出力されないパグをとりました。
(2)旧書式から新書式へのコンバータを造りました。

  03/06/22     Ver. 1.22  (1)2003年7月からの新書式、それ以前の旧書式に合わせて、それぞれテンプレート入力を可能にしました。

(2)2003年7月からの新書式、それ以前の旧書式に合わせた段落番号付けを可能にしました。具体的には、「の詳細な説明】」の欄があれば、旧書式、「【技術分野】」の欄があれば、新書式、いずれもなければ段落番号付けしません。

(3)テンプレート入力で、【書類名】図面の図面番号が正しく入力されないバグを取りました。

(4)今までは、文書名をつけていない状態でマクロを立ち上げると文書名を付けることことを促し、それに従わない場合にはマクロを実行しない、としていましたが、近頃では作者自体もこの設定をわずらわしく感じるようになったので、制限を排除しました。すなわち、新規文書作成中若しくは秀丸を立ち上げたばかりの時でも、マクロは働きます。その分、このマクロを使われる方はご注意の程を。

(5)緊急ver.upですので、ヘルプの部分は一切手を加えておらず、従って今回改訂した部分はヘルプに反映していません。

  02/08/30     Ver. 1.21  2002年9月実施の「先行技術文献開示」に合わ
                          せ、明細書のテンプレートに

                  　　　　【特許文献１】
　　　　                  【非特許文献１】

                          を組込んだことと、段落番号付け時にこれら文
                          献表示の最初にだけ段落番号がつくようにした
                          こと、更にはこれらも段落番号と同様にナンバ
                          リング、リナンバリング可能としたことです。
                          
  00/11/30     Ver. 1.20  願書・明細書・図面・要約書のテンプレートを
                          一元化したことと、要約書の文字数カウントが
                          より確実になるよう、「要約書」を検索するの
                           ではなく「【書類名】　　(所要数の空白)　要
                          約書」を検索して、文字数をカウントするように
                          した。

　00/03/27     Ver. 1.19  marpat.macとhdpaso.macを合体。おまけの
                          sortu_i.macを割愛し、段落番号付けのオプ
                          ションを改良し、POKANさんの 秀丸用明細
                          書作成支援マクロ Asispat.mac の利用に役
                          立つよう●◆を複数箇所に連続して入力でき
                          るようにした。位置覚え機能もなくした。
  99/05/10     Ver. 1.18  FWINALの会議室で、秀丸エディタのマクロ
                          で単語頻度表のようなものができないかと
                          いう話題になり、上記した中河原さんの
                          cbsort.exeの活用を思いつく。
                          で、今回は本体のmarpat.macやhdpaso.mac
                          には全く変更がなく、sort関連のsortu_i.mac
                          をおまけに付けただけです。
  99/03/31     Ver. 1.17  Ver.1.14での改良点、即ち、html文書の段
                          落番号付けができるようにした点と、要約
                          書の文字数カウントでタグ<BR>、</PRE>、
                          </BODY>、</HTML>を計数しないようにした
                          点が、いつのまにか消えうせて(^^ゞいたの
                          で、復元したm(__)m。予め範囲指定してあ
                          れば、要約書の文字数カウントで、その範
                          囲の文字数をカウントするように改良した。
                          秀丸エディタVer.3.00でタグ付き正規表現
                          が利用できるようになったので、符号表の
                          作成に利用した(Ver.3.00 以上の場合は...
                          というように条件分けしているので秀丸エ
                          ディタVer.2.90以下でも使用可)。
  99/01/05     Ver. 1.16  本年1月1日施行の特許法改正で、願書に発
                          明/考案の名称と請求項の数の記載が不要に
                          なったことに対応して、hdpaso.macを直した。
                          hdpaso.macからmarpat.macを呼べるようにし
                          た。marpat.macには実質的な変更なし。
  98/10/19     Ver. 1.15  マクロの開始時に、対象の文書が未だ名前を
                          付けられていない(一回も保存されていない)
                          かどうかをチェックし、付けられていない場
                          合には、付けるよう促すことを強化した。名
                          前が付けられている文書に対しては、その時
                          点までの内容を一端保存するようになってい
                          る。Wordとの連動マクロに進化たための、更
                          なる安全対策である。
                          Wordとの連動とは、秀丸で現在開いている、
                          上付きやｱﾝﾀﾞｰﾗｲﾝ等のタグ付きの特許庁仕様
                          html文書をクリップボードにコピーし、MS-
                          WORDを一時的に開いて上付きやｱﾝﾀﾞｰﾗｲﾝ付き
                          のWord文書としてﾍﾟｰﾊﾟﾚｽ.dot上の新規文書と
                          して、一時的な印刷に供するものである。エ
                          ディタの印刷能力を補うことが目的。同梱の
                          入力支援マクロhdpaso.macにこの機能を取り
                          入れた。
  98/09/01     Ver. 1.14  marpat.macで、html文書の段落番号付けがで
                          きるようにした。要約書の文字数カウントで
                          タグ<BR>、</PRE>、</BODY>、</HTML>を計数
                          しないようにした。
  98/05/22     Ver. 1.13  今回から、マクロファイル自体にはverの数字
                          をからめないようにした。即ち、marpat13.mac
                          ではなくmarpat.macにhdpaso07.macではなく
                          hdpaso.macにした。マクロ登録時の不便を減
                          らすためである。hdpaso.macのテンプレート
                          入力で、HTMLの頭や尾のタグを付けるかどう
                          か選べるようにした。請求項の数を選べるよ
                          うにした。発明や考案の名称も設定できるよ
                          うにした（デフォルトは＝＝という表記で、
                          これをそのまま使う場合、後で名称に一括置
                          換すればよい）。<IMG SRC>命名法を、ファイ
                          ル名基幹部（勝手に名づけているが、拡張子
                          以外の部分のこと）の下何文字+ユーザ指定字
                          +１又は０１又は００１から始まる連番+.BMP
                          又は.GIFに変更。明細書部分の、【産業上の
                          利用分野】を【発明（考案）の属する技術分
                          野】に、【実施の形態】を【発明（考案）の
                          実施の形態】に変更。その他、テンプレート
                          の内容を充実させた。バグ取りも行った。
  98/04/21     Ver. 1.12  本体のmarpatマクロには内容の変更なし。同
                          梱の入力支援マクロhdpasoに関し、実用性の
                          面から明細書・図面・要約書ﾃﾝﾌﾟﾚｰﾄの部分的
                          な挿入を可能にしたこと、タグ入力がより入
                          力しやすい形で連続にできるよう更に工夫し
                          たことが変更点。連続したタグ付けを終了す
                          る際には、タグの開始点と終了点を同じにす
                          る、即ち、Enterキーを同一箇所で２回続けて
                          押せばよい、のは変えていない。
  98/03/30     Ver. 1.11  本体のmarpatマクロには変更なし。同梱の入
                          力支援マクロhdpasoに関し、実用性の面から、
                          ﾃﾝﾌﾟﾚｰﾄを願書ﾃﾝﾌﾟﾚｰﾄと、明細書・図面・要
                          約書ﾃﾝﾌﾟﾚｰﾄとに分けなおしたこと、後者に関
                          して図１０がうまく入力されないバグを取っ
                          たこと、下線等のタグ入力がより入力しやす
                          い形で連続にできるようにしたことが変更点。
                          最後の点に関し、付け加えると、連続したタ
                          グ付けを終了する際には、タグの開始点と終
                          了点を同じにする、即ち、Enterキーを同一
                          箇所で２回続けて押せばよい。
  98/03/23     Ver. 1.10  本体のmarpatマクロにはver.1.09からの変更
                          は実質的にはない。同梱の入力支援マクロ
                          hdpasoに関して、図面・要約書ﾃﾝﾌﾟﾚｰﾄでgif
                          の指定がうまくできなかったバグ取りをした
                          こと、入力図面名についてﾕｰｻﾞがカスタマイ
                          ズできるようにしたこと、願書ﾃﾝﾌﾟﾚｰﾄから
                          郵便番号の欄を削除したこと、が変更点であ
                          る。
  98/01/26     Ver. 1.09  ヘルプを両マクロに加えた。メニューの表記
                          を少し変えてわかりやすくした。パソコン電
                          子出願入力支援マクロに、願書・明細書、図
                          面・要約書のテンプレートを導入。
  97/11/10     Ver. 1.08  段落番号非付与を積極的に印付けすることが
                          オプションでできるようにした。段落番号の
                          付け取り時の、位置おぼえが今まで不確実だ
                          ったので、派手なマーク
                          ★★★★★★依田ｼｹﾞﾙ★★★★★★
                          を一時的に入れてそれを目印とするようにし
                          た。
  97/11/04     Ver. 1.071 Ver.1.07と同一内容のものを再アップロード。
　97/10/30     Ver. 1.07  ソフトバンクのＣＤ本「まるごと秀丸ブック」
                          を読んでいて、ああ、秀まるおさんのマクロ
                          サーバがあるじゃないか、と気づいた。添付
                          のＣＤからマクロサーバをwindowsフォルダに
                          インストールして、早速本マクロに利用。タ
                          イトルバーを掴んでメニューの位置を動かせ
                          るからとっても便利。ﾊﾟｿｺﾝ電子出願入力支
                          援マクロも連続使用に耐えるよう、少し改良。
                          ユーザの方が、途中の範囲指定の個所でマク
                          ロのバグだとか、マクロが終了したと勘違い
                          しなければよいが．．．．．．．(^^ゞ
  97/10/20     Ver. 1.061 marpatの中でＨＴＭＬ入力支援マクロを
                          hdpaso00.macとしてあったため、立ち上がら
                          ないバグを訂正しただけ。(*_*)
  97/10/20     Ver. 1.06 cbsort.exeが存在しているかどうかチェックす
                         る個所で、バグがあったため緊急にVER.UP。メ
                         ニューも少しいじって、設定項目を増やした。
                         メニューの位置を、文字ｶｰｿﾙ付近とするｶｰｿﾙﾒﾆ
                         ｭｰとﾏｳｽｶｰｿﾙ付近とするﾏｳｽﾒﾆｭｰとを選択できる
                         ようにし、符号表のﾌｧｲﾙ名を、ﾌｺﾞｳﾋｮｳ.TXTと原
                         文名+ﾌｺﾞｳﾋｮｳ.TXTとで選べるようにした。
                         hdpaso.macのiniファイルのスペリングを直して、
                         marpat.macと同一にした。
  97/10/17     Ver. 1.05 メニューをキーボードからセレクトできるよう 
                         にした。設定を選択できるようにした。設定内
                         容は、マクロと同じフォルダのMARPAT.INI(設定
                         すると、自動作成される）に保存。hdpaso00.mac
                         を添付して、ＨＴＭＬ支援とした。段落番号の
                         付け取り時後に、カーソルができるだけ元の位
                         置近くになるように試みた。その他細かい訂正。
  97/06/27     Ver. 1.042ひさしぶりでライブラリィをぶらりと見たとこ
                         ろV.1.04がアップロードされていないことに気
                         づき、再アップロード。内容は変えていません。
  97/06/17     Ver. 1.04 符号表で〜を含む符号を取り込める用改良。当
                         方の手違いでＬｉｂにアップロード失敗。
  97/06/13     Ver. 1.03 中河原与太郎さんのCBSort150.lzhを利用させ
                         ていただいて、符号表作成の高速化を計る。要
                         約書の文字数カウント機能をを追加。符号表に
                         取り込める文字を拡張したので例えば亜亜、龠
                         龠などのゴミが混じるかもしれないけど、「あ
                         あ」と言って了解してくださいね。
  97/05/01   Ver. 1.02β 事情あってVer.No.がいきなり1.02。符号表で
                         きるようになったが、速度が遅すぎる (^^;
  97/04/23   Ver. 1.00   ＷＺeditor用マクロから移植.正規表現DLLの違
                         いから符号表処理の開発遅れる。ＬＩＢ１９へ
                         アップロードすべきところ、間違ってＬＩＢ８
                         にアップロードしてしまった．

【免責・謝辞】
　このソフトは、オンラインソフトウェアです。バグがあっても私は修正
する責任を持ちませんし、このソフトの使用により発生したいかなる損害
に対しても、一切責任を持ちませんから、利用者は、各自の責任にてご使
用ください。
　このマクロの改変・転載は自由としますが、混乱を避けるため、改変し
たものを転載することは禁止といたします。現状の圧縮ファイルのままで
転載してください。転載する場合、予め作者へメイルでご連絡下さい。

                                                   依田　茂
                    e-mail:  uni@unicorned.com
                    URL:     http://macro.unicorned.com/
                             http://blog.goo.ne.jp/unicorned/

